---
import { sanityClient } from "sanity:client";

import Shape from "@/components/Shape.astro";
import FeatureBannerSanity from "@/components/features/FeatureBannerSanity.astro"
import ProjecManagement from "@/components/features/ProjecManagement.astro";
import CtaSanity from "@/partials/CtaSanity.astro";

const { lang } = Astro.props;

const wikiPageData = await sanityClient.fetch(
  `*[_type == 'wikiPage' && language == '${lang}'] {
      title,
      heroSection,
      postsTitle,
      ctaBanner
  }`
);

const { title, heroSection, ctaBanner, postsTitle } = wikiPageData[0] || {}

const posts = await sanityClient.fetch(
  `*[_type == 'wiki' && language == '${lang}'] | order(orderRank){
      ...,
      'conflictType': conflictType[]->{
        slug,
        title
      },
  }`
);
---

<>
  <Shape />
  <FeatureBannerSanity title={title} heroSection={heroSection}  />
  <ProjecManagement features={posts} postsTitle={postsTitle} />
  <CtaSanity ctaBanner={ctaBanner} />
</>
