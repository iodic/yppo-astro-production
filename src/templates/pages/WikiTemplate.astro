---
import { sanityFetch } from "@/lib/utils/sanityFetch"

import Base from "@/layouts/Base.astro"
import Shape from "@/components/Shape.astro"
import FeatureBanner from "@/components/features/FeatureBanner.astro"
import ProjecManagement from "@/components/features/ProjecManagement.astro"
import Cta from "@/partials/Cta.astro"

const { lang } = Astro.props

const wikiPageData = await sanityFetch({
  type: "wikiPage",
  lang,
  object: `{
      title,
      pageMetadata {
        ...,
        "metaImage": metaImage.asset->url,
      },
      heroSection,
      postsTitle,
      ctaBanner
  }`
})

const { title, pageMetadata, heroSection, ctaBanner, postsTitle } = wikiPageData[0] || {}
const { metaTitle, metaDescription, metaImage, noIndex, canonicalUrl } = pageMetadata || {}
---

<Base
  title={title && title}
  meta_title={metaTitle && metaTitle}
  description={metaDescription && metaDescription}
  image={metaImage && metaImage}
  noindex={noIndex && noIndex}
  canonical={canonicalUrl && canonicalUrl}
  lang={lang}
>
  <Shape />
  <FeatureBanner title={title} heroSection={heroSection} />
  <ProjecManagement postsTitle={postsTitle} lang={lang} />
  <Cta ctaBanner={ctaBanner} />
</Base>
