---
import { sanityFetch } from "@/lib/utils/sanityFetch"

import Base from "@/layouts/Base.astro"
import Banner from "@/layouts/components/Banner.astro"
import KeyFeatures from "@/layouts/components/KeyFeatures.astro"
import Testimonial from "@/layouts/components/Testimonial.astro"
import Cta from "@/partials/Cta.astro"

const { lang } = Astro.props

const homepageData = await sanityFetch({
  type: "homepage",
  lang,
  object: `{
      title,
      pageMetadata {
        ...,
        "metaImage": metaImage.asset->url,
      },
      heroSection {
        ...,
        videoCard {
          ...,
          "videoPoster": videoPoster.asset->url
        }
      },
      cardsSection,
      reviewsSection {
        ...,
        cards[] {
          ...,
          "image": image.asset->url,
        }
      },
      ctaBanner
  }`
})

const { title, pageMetadata, heroSection, cardsSection, reviewsSection, ctaBanner } = homepageData[0] || {}
const { metaTitle, metaDescription, metaImage, noIndex, canonicalUrl } = pageMetadata || {}
---

<Base
  title={title && title}
  metaTitle={metaTitle && metaTitle}
  description={metaDescription && metaDescription}
  metaImage={metaImage && metaImage}
  noIndex={noIndex && noIndex}
  canonical={canonicalUrl && canonicalUrl}
  lang={lang}
>
  <!-- banner -->
  <Banner banner={heroSection} />
  <!-- key features -->
  <KeyFeatures cardsData={cardsSection} />
  <!-- testimonial -->
  <Testimonial testimonialsData={reviewsSection} />
  <!-- call to action -->
  <Cta ctaBanner={ctaBanner} />
</Base>
