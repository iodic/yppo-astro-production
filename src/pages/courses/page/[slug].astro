---
import { sanityClient } from "sanity:client"

import CoursesSlugTemplate from "@/templates/pages/CoursesSlugTemplate.astro"
import config from "@/config/config.json"

import { i18nConfig } from "@/i18n/i18nConfig"

export async function getStaticPaths() {
  const { defaultLocale } = i18nConfig
  const posts = await sanityClient.fetch(`*[_type == 'course' && featured != false && language == '${defaultLocale}'] | order(_createdAt desc)`)

  const totalPages = Math.ceil(posts.length / config.settings.pagination)
  const paths = []

  for (let i = 1; i < totalPages; i++) {
    paths.push({
      params: {
        slug: (i + 1).toString()
      }
    })
  }
  return paths
}

const { slug } = Astro.params
const currentLanguage = Astro.currentLocale
---

<CoursesSlugTemplate slug={slug} lang={currentLanguage} />
