---
import CoursesSlugTemplate from "@/templates/pages/CoursesSlugTemplate.astro"

import { i18nConfig } from "@/i18n/i18nConfig"
import { sanityFetch } from "@/lib/utils/sanityFetch"
import getCoursesData from "@/lib/utils/getCoursesData"

export async function getStaticPaths() {
  const { defaultLocale } = i18nConfig
  const posts = await sanityFetch({ type: "course", query: "featured != true", pipe: "order(_createdAt desc)" })
  const { totalPages } = getCoursesData(posts, defaultLocale)
  const paths = []

  for (let i = 1; i < totalPages; i++) {
    paths.push({
      params: {
        slug: (i + 1).toString()
      }
    })
  }
  return paths
}

const { slug } = Astro.params
const currentLanguage = Astro.currentLocale
---

<CoursesSlugTemplate slug={slug} lang={currentLanguage} />
