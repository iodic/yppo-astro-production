---
import { sanityClient } from "sanity:client"

import Base from "@/layouts/Base.astro"
import WikiSingle from "@/layouts/WikiSingle.astro"

import { i18nConfig } from "@/i18n/i18nConfig"

export async function getStaticPaths() {
  const { defaultLocale } = i18nConfig

  const posts = await sanityClient.fetch(`*[_type == 'conflictType' && language == '${defaultLocale}'] | order(_createdAt desc)`)

  const paths = posts
    .filter((post: any) => post?.slug?.current)
    .map((post: any) => ({
      params: {
        single: post.slug.current,
        lang: defaultLocale
      },
      props: { post }
    }))

  return paths
}

const { post, lang } = Astro.props
const { title, description, image } = post
---

<Base title={title} description={description} image={image} lang={lang}>
  <WikiSingle post={post} />
</Base>
