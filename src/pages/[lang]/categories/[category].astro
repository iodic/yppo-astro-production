---
import { i18nConfig } from "@/i18n/i18nConfig"

import CategoryTemplate from "@/templates/pages/CategoryTemplate.astro"

import config from "@/config/config.json"
import { getTaxonomy } from "@/lib/taxonomyParser.astro"
import { slugify } from "@/lib/utils/textConverter"

export async function getStaticPaths() {
  const paths: any = []
  const { defaultLocale, locales } = i18nConfig

  const categories = await getTaxonomy(config.settings.blog_folder, "categories")

  locales.map((currentLocale: string) => {
    if (currentLocale !== defaultLocale) {
      categories.map((item: any) => {
        const category = slugify(item)

        paths.push({
          params: {
            lang: currentLocale,
            category
          },
          props: { item }
        })
      })
    }
  })

  return paths
}

const { category, lang } = Astro.params
const { item } = Astro.props
---

<CategoryTemplate item={item} category={category} lang={lang} />
