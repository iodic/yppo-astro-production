---
import { sanityFetch } from "@/lib/utils/sanityFetch"

import { i18nConfig } from "@/i18n/i18nConfig"

import Base from "@/layouts/Base.astro"
import BlogSingle from "@/layouts/BlogSingle.astro"

export async function getStaticPaths() {
  const paths: any = []
  const { defaultLocale, locales } = i18nConfig
  const posts = await sanityFetch({ type: "course", query: `language != '${defaultLocale}'`, pipe: "order(_createdAt desc)" })

  locales.map((currentLocale: string) => {
    if (currentLocale !== defaultLocale) {
      posts.map((post: any) =>
        paths.push({
          params: {
            lang: currentLocale,
            single: post.slug.current
          },
          props: { post }
        })
      )
    }
  })

  return paths
}

const { lang } = Astro.params
const { post } = Astro.props
const { title, description, image } = post
---

<Base title={title} description={description} image={image} lang={lang}>
  <BlogSingle post={post} />
</Base>
