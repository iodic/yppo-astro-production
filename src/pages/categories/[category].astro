---
import { i18nConfig } from "@/i18n/i18nConfig"
import getCoursesCategories from "@/lib/utils/getCoursesCategories"

import CategoryTemplate from "@/templates/pages/CategoryTemplate.astro"

import { slugify } from "@/lib/utils/textConverter"
import { sanityFetch } from "@/lib/utils/sanityFetch"

export async function getStaticPaths() {
  const { defaultLocale } = i18nConfig

  const posts = await sanityFetch({ type: "course", lang: defaultLocale, pipe: "order(_createdAt desc)" })
  const allCategories = getCoursesCategories(posts)

  return allCategories.map((categoryItem: any) => {
    const categorySlug = slugify(Object.keys(categoryItem)?.[0])

    return {
      params: { category: categorySlug },
      props: {
        category: Object.values(categoryItem)[0],
        allCategories,
        allPosts: posts,
        lang: defaultLocale
      }
    }
  })
}

const { category, allCategories, allPosts, lang } = Astro.props
---

<CategoryTemplate category={category} allCategories={allCategories} allPosts={allPosts} lang={lang} />
