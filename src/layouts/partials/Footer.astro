---
import { Image } from "astro:assets"
import { sanityClient } from "sanity:client"

import config from "@/config/config.json"
import menu from "@/config/menu.json"
import { markdownify } from "@/lib/utils/textConverter"

import SocialItem from "@/components/SocialItem.astro"
import LanguageSwitcher from "@/components/LanguageSwitcher.astro"

const { lang } = Astro.props

const footerData = await sanityClient.fetch(
  `*[_type == 'footer' && language == '${lang}'] {
      "logoSrc": logo.asset->url,
      description,
      enableLanguageSwitcher,
      socials
  }`
)

const { logoSrc, description, enableLanguageSwitcher, socials } = footerData[0] || {}

interface SocialItem {
  socialsType: string
  url: string
}

const { footer } = menu
const { copyright, location, email, phone } = config.params
---

<footer class="footer bg-[#F1F1F1]">
  <div class="container">
    <div class="lg:gx-5 row pb-10 pt-[52px]">
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        {logoSrc ? <Image src={logoSrc} alt="" width={231} height={74} /> : "Yppo"}

        {description && <p class="mt-6">{description}</p>}

        {enableLanguageSwitcher && <LanguageSwitcher />}
      </div>

      {
        socials && (
          <div class="col-12 mt-12 md:col-6 lg:col-3">
            {socials?.title && <h6>{socials?.title}</h6>}

            {socials?.socialsRepeater && (
              <ul class="social-icons mt-4 lg:mt-6">
                {socials?.socialsRepeater?.map(({ socialsType, url }: SocialItem) => {
                  return <SocialItem socialsType={socialsType} url={url} />
                })}
              </ul>
            )}
          </div>
        )
      }

      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Quick Links</h6>
        <ul>
          {
            footer.map((item, i) => (
              <li class={footer.length - 1 === i ? "mb-0" : "mb-4"}>
                <a class="hover:text-primary hover:underline " href={item.url}>
                  {item.name}
                </a>
              </li>
            ))
          }
        </ul>
      </div>
      <div class="col-12 mt-12 md:col-6 lg:col-3">
        <h6>Contact</h6>
        <ul>
          <li class="mb-2">
            <a class="mb-2 hover:text-primary" href={`mailto:${email}`}>{email}</a>
          </li>
          <li>
            <a class="hover:text-primary hover:underline" href={`tel:${phone}`}>{phone}</a>
          </li>
          <li>
            <a href="/contact" class="btn btn-white mt-4">Contact</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container max-w-[1440px]">
    <div class="footer-copyright mx-auto border-t border-border pb-10 pt-7 text-center">
      <p class="content text-text" set:html={markdownify(copyright)} />
    </div>
  </div>
</footer>
